{"version":3,"file":"ui-lib.js","sources":["../src/util.js","../src/create-element.js","../src/lifeCycleRunner.js","../src/diff/dom.js","../src/diff/children.js","../src/component.js","../src/diff/toSimpleVnode.js","../src/diff/index.js","../src/render.js","../src/pkg/AsyncComponent/AsyncComponent.js","../src/pkg/router/router.js"],"sourcesContent":["/**\n * @type {(cb) => any}\n * @returns {Promise<any>}\n */\nexport const defer =\n  typeof Promise == \"function\"\n    ? Promise.prototype.then.bind(Promise.resolve())\n    : setTimeout;\n\nexport const EMPTY_OBJ = {};\nexport const EMPTY_ARR = [];\n\nconst _Obj = EMPTY_OBJ.constructor;\nconst hasOwnProp = EMPTY_OBJ.hasOwnProperty;\nconst hasAssign = \"assign\" in _Obj;\n\n/**\n * from @hydrophobefireman/j-utils\n * @type {ObjectConstructor['assign']}\n */\nexport const assign = hasAssign\n  ? _Obj.assign\n  : function(target) {\n      for (let i = 1; i < arguments.length; i++) {\n        const source = arguments[i];\n        for (const key in source) {\n          if (hasOwnProp.call(source, key)) {\n            target[key] = source[key];\n          }\n        }\n      }\n      return target;\n    };\n\n/**\n *\n * @param {Array<Array<T>>} arr\n * @param {number} depth\n * @param {()=>T} map\n * @returns {Array<T>}\n */\nexport function flattenArray(arr, depth, map, removeHoles = false) {\n  const flattend = [];\n  const flat = (array, depth) => {\n    for (const el of array) {\n      if (Array.isArray(el) && depth > 0) {\n        flat(el, depth - 1);\n      } else {\n        if (!removeHoles || el != null) flattend.push(map ? map(el) : el);\n      }\n    }\n  };\n  flat(arr, ~~depth || 1);\n  return flattend;\n}\n\nexport const $ = {\n  /**\n   *\n   * @param {import(\"./ui\").UiElement} dom\n   * @param {string} key\n   * @param {any} value\n   */\n  setAttribute(dom, key, value) {\n    if (key in dom) {\n      return (dom[key] = value == null ? \"\" : value);\n    } else {\n      if (value == null) return dom.removeAttribute(key);\n      return dom.setAttribute(key, value);\n    }\n  }\n};\n/**\n * @type {string}\n */\nexport const isListener = attr => attr[0] === \"o\" && attr[1] === \"n\";\n\n/**\n * @type {any}\n * @returns {boolean}\n */\nexport function isStringLike(a) {\n  return typeof a === \"string\" || typeof a === \"number\";\n}\n\n/**\n *\n * @param {import(\"./ui\").UiElement} parentDom\n * @param {import(\"./ui\").UiNode} child\n */\nexport function appendChild(parentDom, child) {\n  if (child == null) return;\n  let vn;\n  let hasVn;\n  let insertBefore;\n  if ((hasVn = (vn = child._vNode) != null)) {\n    insertBefore = child._vNode._nextDomNode;\n  }\n\n  if (child.parentNode !== parentDom || vn._reorder) {\n    if (insertBefore != null) {\n      parentDom.insertBefore(child, insertBefore);\n    } else {\n      if (!vn._reorder) parentDom.appendChild(child);\n    }\n  }\n  /**@type {import(\"./ui\").UiNode} */\n  const prevDom = child.previousSibling;\n  /**@type {import(\"./ui\").UiNode} */\n  const nextDom = child.nextSibling;\n  if (prevDom == nextDom) return; //will only be equal if they are null\n  if (prevDom != null) {\n    const prevVnode = prevDom._vNode;\n    if (prevVnode != null && prevVnode._nextDomNode !== child) {\n      setDomNodeDescriptor(prevVnode, child, \"_nextDomNode\");\n    }\n  }\n\n  if (nextDom != null) {\n    const nextVnode = nextDom._vNode;\n    if (nextVnode != null && nextVnode._nextDomNode !== child)\n      setDomNodeDescriptor(nextVnode, child, \"_prevDomNode\");\n  }\n  if (hasVn) {\n    vn._prevDomNode = prevDom;\n    vn._nextDomNode = nextDom;\n  }\n}\n\n/**\n *\n * @param {import(\"./ui\").vNode} node\n * @param {import(\"./ui\").UiNode} sibDom\n * @param {\"_prevDomNode\"|\"_nextDomNode\"} desc\n */\nexport function setDomNodeDescriptor(node, sibDom, desc) {\n  if (node == null) return;\n  node[desc] = sibDom;\n  const c = node._prevVnode;\n  setDomNodeDescriptor(c, sibDom, desc);\n}\n","import { isListener, flattenArray, assign } from \"./util.js\";\n\n/**\n *\n * @param {import(\"./ui\").createElementArgType} type\n * @param {{}} props\n * @param  {Array<import(\"./ui\").createElementArgType>} children\n */\nexport function createElement(type, props, ...children) {\n  if (type == null || typeof type === \"boolean\") return null;\n  if (props == null) {\n    props = {};\n  } else {\n    props = assign({}, props);\n  }\n  if (children.length) {\n    children = flattenArray(children, Infinity);\n    props.children = children;\n  }\n  const ref = props.ref;\n  if (ref) delete props.ref;\n  const key = props.key;\n  if (key) delete props.key;\n  const events = {};\n  for (const i in props) {\n    if (isListener(i)) {\n      events[i.substr(2).toLowerCase()] = props[i];\n      // delete props[i];\n    }\n  }\n  return getVNode(type, props, events, key, ref);\n}\nexport function Fragment() {}\nexport function getVNode(type, props, events, key, ref) {\n  /**\n   * @type {import(\"./ui\").vNode}\n   */\n  const vnode = {\n    type: (typeof type === \"string\" ? type.toLowerCase() : type),\n    props,\n    events,\n    key,\n    _reorder: false,\n    ref,\n    _children: null,\n    _dom: null,\n    _component: null,\n    __uAttr: null,\n    _nextDomNode: null,\n    _prevDomNode: null,\n    _prevVnode: null\n  };\n  return (vnode.__uAttr = vnode);\n}\n/**\n *\n * @param {any} nodeType\n * @returns {import(\"./ui\").vNode}\n */\nexport function toVnode(nodeType) {\n  if (nodeType == null || typeof nodeType === \"boolean\") {\n    return null;\n  }\n  if (typeof nodeType === \"string\" || typeof nodeType === \"number\") {\n    return getVNode(null, String(nodeType));\n  }\n  if (Array.isArray(nodeType)) {\n    return createElement(Fragment, null, nodeType);\n  }\n\n  // Clone vnode if it has already been used.\n  if (nodeType._dom != null) {\n    const vnode = getVNode(\n      nodeType.type,\n      nodeType.props,\n      nodeType.events,\n      nodeType.key,\n      null\n    );\n    vnode._dom = nodeType._dom;\n    return vnode;\n  }\n\n  return nodeType;\n}\n","import { EMPTY_OBJ, EMPTY_ARR, setDomNodeDescriptor } from \"./util.js\";\n\n/**\n *\n * @param {import(\"./component\").default} c\n * @param {import(\"./ui\").lifeCycleMethod} method\n * @param {boolean} [recurses]\n */\nexport function runLifeCycle(c, method, ...args) {\n  if (!c) return;\n  c.__currentLifeCycle = method;\n  if (c[method] != null) {\n    const fn = function() {\n      c[method].apply(c, args);\n    };\n    if (typeof Promise !== \"undefined\") {\n      return Promise.resolve(fn()).catch(\n        e => c.componentDidCatch && c.componentDidCatch(e)\n      );\n    }\n    try {\n      fn();\n    } catch (e) {\n      c.componentDidCatch && c.componentDidCatch(e);\n    }\n  }\n}\n\n/**\n *\n * @param {import(\"./ui\").vNode} node\n */\nexport function unmountDomTree(node) {\n  if (node === EMPTY_OBJ || node == null) return;\n  if (node._prevVnode) unmountDomTree(node._prevVnode);\n  const dom = node._dom;\n  const cc = node._component;\n  runLifeCycle(cc, \"componentWillUnmount\", true);\n  if (cc != null) cc.base = cc._vnode = null;\n  if (!dom) {\n    return;\n  }\n  if (node._nextDomNode != null)\n    setDomNodeDescriptor(node._nextDomNode._vNode, null, \"_prevDomNode\");\n  if (node._prevDomNode != null)\n    setDomNodeDescriptor(node._prevDomNode._vNode, null, \"_nextDomNode\");\n  for (const child of node._children || EMPTY_ARR) {\n    unmountDomTree(child);\n  }\n  node._prevVnode = node._component = node._dom = node._prevDomNode = node._nextDomNode = null;\n\n  if (Array.isArray(dom)) {\n    let d;\n    while ((d = EMPTY_ARR.pop.call(dom || EMPTY_ARR))) {\n      removeNode(d);\n    }\n  } else {\n    removeNode(dom);\n  }\n  dom.onclick = dom._component = dom._listeners = dom._prevVnode = dom._vNode = dom._currentProps = null;\n}\n\n/**\n * @param {Node} node\n */\nexport function removeNode(node) {\n  const p = node.parentNode;\n  if (p) {\n    p.removeChild(node);\n  }\n}\nexport function commitMounts(mounts) {\n  let c;\n  while ((c = mounts.pop())) {\n    runLifeCycle(c, \"componentDidMount\");\n    c._didMount = true;\n  }\n}\n","import { $, EMPTY_OBJ, isListener } from \"../util.js\";\nimport { Fragment } from \"../create-element.js\";\n\n/**\n *\n * @param {import(\"../ui\").vNode} newVnode\n * @param {import(\"../ui\").vNode} oldVnode\n * @param {import(\"../ui\").UiNode} previousDom\n * @param {boolean} _DisableDiff\n */\nexport function diffDom(newVnode, oldVnode, previousDom, _DisableDiff) {\n  /**\n   * @type {import(\"../ui\").UiNode}\n   */\n  let el;\n  const type = newVnode.type;\n  // should be called when there is a type mismatch  or we are in a brand new vnode (nothing to diff againts)\n  if (_DisableDiff) {\n    if (typeof newVnode.props === \"string\") {\n      el = document.createTextNode(newVnode.props);\n    } else {\n      el = document.createElement(type);\n      diffAttributes(el, newVnode, EMPTY_OBJ);\n    }\n  } else {\n    const oldType = oldVnode.type;\n    if (type !== oldType) {\n      return diffDom(newVnode, null, null, true);\n    } else {\n      el = previousDom;\n      if (previousDom instanceof Text) {\n        const newVal = newVnode.props;\n        if (previousDom.nodeValue !== newVal) {\n          previousDom.nodeValue = newVal;\n        }\n      } else {\n        diffAttributes(el, newVnode, oldVnode);\n      }\n    }\n  }\n  if (newVnode._prevVnode != null) {\n    newVnode._prevVnode._dom = el;\n  }\n  return el;\n}\nconst isSafeAttr = attr => attr !== \"key\" && attr !== \"children\";\n/**\n *\n * @param {import(\"../ui\").UiElement} currentDom\n * @param {import(\"../ui\").vNode} currVnode\n * @param {boolean} hasOldReferenceDom\n * @param {import(\"../ui\").vNode} prevVnode\n */\nfunction diffAttributes(currentDom, currVnode, prevVnode) {\n  if (currentDom instanceof Text) return;\n  const newAttributes = currVnode.props;\n  const prevAttributes = currentDom._currentProps || EMPTY_OBJ;\n  currentDom._currentProps = newAttributes;\n  const currEvents = currVnode.events;\n  const prevEvents = prevVnode != null ? prevVnode.events : EMPTY_OBJ;\n  for (const attr in prevAttributes) {\n    if (!(attr in newAttributes)) {\n      $.setAttribute(currentDom, attr, null);\n    }\n  }\n  for (let attr in newAttributes) {\n    if (isListener(attr) || !isSafeAttr(attr)) continue;\n    let newValue = newAttributes[attr];\n    let oldValue = prevAttributes[attr] || EMPTY_OBJ;\n    if (newValue === oldValue) continue;\n    attr = attr === \"class\" ? \"className\" : attr;\n    if (attr === \"className\") {\n      diffClass(currentDom, newValue, oldValue);\n      continue;\n    } else if (attr === \"style\") {\n      diffStyle(currentDom, newValue, oldValue);\n      continue;\n    }\n    $.setAttribute(currentDom, attr, newValue);\n  }\n  diffEventListeners(currEvents, prevEvents, currentDom);\n}\nfunction diffClass(currentDom, newValue, oldValue) {\n  const isArray = Array.isArray;\n  if (isArray(newValue)) {\n    newValue = newValue.join(\" \").trim();\n  }\n  if (isArray(oldValue)) {\n    oldValue = oldValue.join(\" \").trim();\n  }\n  if (newValue === oldValue) return;\n  $.setAttribute(currentDom, \"className\", newValue);\n}\n\nfunction diffStyle(currentDom, newValue, oldValue) {\n  const st = currentDom.style;\n  if (typeof newValue === \"string\") {\n    st.cssText = newValue;\n    return;\n  }\n  const oldValueIsString = typeof oldValue === \"string\";\n  if (oldValueIsString) {\n    st.cssText = \"\";\n  } else {\n    for (const styleProp in oldValue) {\n      if (!(styleProp in newValue)) {\n        st[styleProp] = \"\";\n      }\n    }\n  }\n  for (const i in newValue) {\n    const prop = newValue[i];\n    if (oldValueIsString || prop !== oldValue[i]) {\n      st[i] = prop;\n    }\n  }\n}\n\n/**\n *\n * @param {Event} e\n * @this {import(\"../ui\").UiElement}\n */\nexport function eventListenerProxy(e) {\n  return this._listeners[e.type].call(this, e);\n}\n\n/**\n *\n * @param {import(\"../ui\").vNode['events']} newListeners\n * @param {import(\"../ui\").vNode['events']} oldListeners\n * @param {import(\"../ui\").UiElement} dom\n */\nexport function diffEventListeners(newListeners, oldListeners, dom) {\n  if (newListeners == oldListeners) return;\n  if (dom._listeners == null) {\n    dom._listeners = {};\n    dom.onclick = Fragment;\n  }\n  if (oldListeners == null) {\n    oldListeners = EMPTY_OBJ;\n  }\n  if (newListeners == null) {\n    newListeners = EMPTY_OBJ;\n  }\n  for (const event in newListeners) {\n    const listener = newListeners[event];\n    const oldListener = oldListeners[event];\n    if (oldListener !== listener && listener != null) {\n      dom.addEventListener(event, eventListenerProxy);\n      dom._listeners[event] = listener;\n    }\n  }\n  for (const evt in oldListeners) {\n    if (newListeners[evt] == null) {\n      delete dom._listeners[evt];\n      dom.removeEventListener(evt, eventListenerProxy);\n    }\n  }\n}\n","import { unmountDomTree } from \"../lifeCycleRunner.js\";\nimport { diff } from \"./index.js\";\nimport { appendChild, EMPTY_OBJ } from \"../util.js\";\n\n/**\n *\n * @param {import(\"../ui\").vNode} newParentVnode\n * @param {import(\"../ui\").vNode['_children']} oldChildren\n * @param {import(\"../ui\").UiElement} parentDom\n * @param {object} context\n * @param {Array<import(\"../ui\").UiComponent>} mounts\n * @param {import(\"../ui\").UiComponent} previousComponent\n * @param {boolean} force\n */\n\nexport function diffChildren(\n  newParentVnode,\n  oldChildren,\n  parentDom,\n  context,\n  mounts,\n  previousComponent,\n  force\n) {\n  const newChildren = newParentVnode._children;\n  const newChildrenLength = newChildren.length;\n  const oldChildrenLength = oldChildren.length;\n  const retArr = [];\n  for (let i = 0; i < Math.max(newChildrenLength, oldChildrenLength); i++) {\n    const newChild = newChildren[i];\n    let oldChild = oldChildren[i] || EMPTY_OBJ;\n    let nextOldChild;\n    if (newChild == null) {\n      if (oldChild != null) {\n        unmountDomTree(oldChild);\n      }\n      continue;\n    }\n    let nextDom = newChild._nextDomNode || oldChild._nextDomNode;\n\n    if (\n      oldChild === EMPTY_OBJ &&\n      (nextOldChild = getNextChild(oldChildren, oldChildrenLength, i)) != null\n    ) {\n      const nextOldDom = nextOldChild._dom;\n      nextDom = Array.isArray(nextOldDom) ? nextOldDom[0] : nextOldDom;\n      newChild._reorder = true;\n    }\n    newChild._nextDomNode = nextDom;\n    const dom = diff(\n      parentDom,\n      newChild,\n      oldChild,\n      context,\n      mounts,\n      previousComponent,\n      force\n    );\n\n    if (!Array.isArray(dom)) {\n      appendChild(parentDom, dom);\n      retArr.push(dom);\n    }\n  }\n\n  return retArr;\n}\n\n/**\n *\n * @param {import(\"../ui\").vNode['_children']} oc\n * @param {Number} len\n * @param {Number} i\n * @returns {import(\"../ui\").vNode}\n */\nfunction getNextChild(oc, len, i) {\n  let c;\n  for (; i < len; i++) {\n    c = oc[i];\n    if (c) break;\n  }\n  return c;\n}\n","import { defer, assign, EMPTY_OBJ, appendChild } from \"./util.js\";\nimport { commitMounts } from \"./lifeCycleRunner.js\";\nimport { diff } from \"./diff/index.js\";\n/**\n * @type {Array<import(\"./ui\").UiComponent>}\n */\nconst RENDER_QUEUE = [];\nclass Component {\n  constructor(props, context) {\n    // /**\n    //  * @type {import(\"./ui\").vNode}\n    //  */\n    // this._vnode = null;\n    // /**\n    //  * @type {Component}\n    //  */\n    // this._previousComponent = null;\n    // /**\n    //  * @type {import(\"./ui\").lifeCycleMethod}\n    //  */\n    // this.__currentLifeCycle = null;\n    this.props = props;\n    this.context = context;\n    this.state = {};\n  }\n  /**\n   * @param {import(\"./ui\").UiComponent['props']} props\n   * @param {this['state']} state\n   * @returns {import(\"./ui\").vNode}\n   */\n  render(props, state) {\n    return;\n  }\n  setState(updater) {\n    this._nextState = assign({}, this.state || EMPTY_OBJ);\n    this._oldState = assign({}, this._nextState);\n    const next =\n      typeof updater === \"function\"\n        ? (updater = updater(this._nextState, this.props))\n        : updater;\n    if (next == null) return;\n    assign(this._nextState, next);\n    assign(this.state, this._nextState);\n    enqueueRender(this);\n  }\n  forceUpdate(callback) {\n    const parentDom = this.parentDom;\n    const mounts = [];\n    if (parentDom) {\n      const force = callback !== false;\n      /**\n       * @type {import(\"./ui\").vNode}\n       */\n      const vn = this._vnode;\n      const _sibDom = vn != null ? vn._nextDomNode : null;\n\n      /**\n       * @type {import(\"./ui\").UiNode}\n       */\n      this.base = diff(parentDom, vn, vn, this.context, mounts, this, force);\n      if (this.base instanceof Node && !this.base.parentNode) {\n        appendChild(parentDom, this.base, _sibDom);\n      }\n    }\n    if (callback) callback();\n    commitMounts(mounts);\n  }\n}\nexport function enqueueRender(c) {\n  c._dirty = true;\n  if (RENDER_QUEUE.push(c) === 1) {\n    window.requestAnimationFrame != null\n      ? window.requestAnimationFrame(process)\n      : defer(process);\n  }\n}\n\nfunction process() {\n  let p;\n  RENDER_QUEUE.sort((x, y) => x._depth - y._depth);\n  while ((p = RENDER_QUEUE.pop())) {\n    if (p._dirty) {\n      p._nextState = null;\n      p._dirty = false;\n      p.forceUpdate(false);\n    }\n  }\n}\nexport default Component;\n","import { runLifeCycle } from \"../lifeCycleRunner.js\";\nimport Component from \"../component.js\";\nimport { assign, EMPTY_OBJ, EMPTY_ARR } from \"../util.js\";\nimport { toVnode } from \"../create-element.js\";\n\n/**\n *\n * @param {import(\"../ui\").vNode} newVnode\n * @param {import(\"../ui\").vNode} oldVnode\n * @param {import(\"../ui\").UiElement} parentDom\n * @param {Array<import(\"../ui\").UiComponent>} mounts\n * @param {object} context\n * @param {boolean} force\n */\nexport function toSimpleVnode(\n  newVnode,\n  oldVnode,\n  parentDom,\n  mounts,\n  context,\n  force,\n  previousComponent\n) {\n  /**\n   * @type {import(\"../ui\").UiComponent}\n   */\n  let c;\n  /**\n   * @type {import(\"../ui\").vNode}\n   */\n  let vnode;\n  let isNew;\n  const newType = newVnode.type;\n  if (oldVnode._component) {\n    c = newVnode._component = oldVnode._component;\n    c.base = newVnode._dom = oldVnode._dom;\n    c.props = newVnode.props;\n    c.context = context;\n    isNew = false;\n    if (!force) {\n      if (\n        c.shouldComponentUpdate != null &&\n        c.shouldComponentUpdate(newVnode.props, c.state) !== false\n      ) {\n      } else if (c.shouldComponentUpdate != null) {\n        return { node: EMPTY_OBJ, shouldUpdate: false };\n      }\n    }\n  } else {\n    isNew = true;\n    if (newType.prototype && newType.prototype.render) {\n      c = newVnode._component = new newType(newVnode.props, context);\n      mounts.push(c);\n    } else {\n      c = new Component(newVnode.props, context);\n      newVnode._component = null;\n      c.constructor = newType;\n      c.render = getRenderer;\n    }\n  }\n  c.parentDom = parentDom;\n  if (c.state == null) c.state = {};\n  c._nextState = assign({}, c.state);\n  if (newType.getDerivedStateFromProps != null) {\n    assign(\n      c._nextState,\n      newType.getDerivedStateFromProps(newVnode.props, c._nextState) ||\n        EMPTY_OBJ\n    );\n    assign(c._oldState || (c._oldState = {}), c._nextState);\n  }\n\n  if (isNew) {\n    runLifeCycle(c, \"componentWillMount\");\n  } else {\n    runLifeCycle(\n      c,\n      \"componentWillUpdate\",\n      newVnode.props,\n      c._nextState,\n      context\n    );\n  }\n  c.state = c._nextState;\n  vnode = c._prevVnode = toVnode(c.render(newVnode.props, c.state));\n  if (vnode) {\n    vnode._dom = newVnode._dom;\n    vnode._reorder = newVnode._reorder;\n  } //we maybe rendering null\n  c._depth = previousComponent ? ~~previousComponent._depth + 1 : 0;\n  return { node: vnode, shouldUpdate: !isNew };\n}\n\nfunction getRenderer(props, _, context) {\n  return this.constructor(props, context);\n}\n","/**\n *  @TODO refactor loops and fix variable naming\n */\nimport { Fragment, toVnode } from \"../create-element.js\";\nimport { flattenArray, EMPTY_OBJ, EMPTY_ARR } from \"../util.js\";\nimport { unmountDomTree, runLifeCycle } from \"../lifeCycleRunner.js\";\nimport { diffDom } from \"./dom.js\";\nimport { diffChildren } from \"./children.js\";\nimport { toSimpleVnode } from \"./toSimpleVnode.js\";\n/**\n *\n * @param {import(\"../ui\").UiElement} parentDom\n * @param {import(\"../ui\").vNode} newVnode\n * @param {import(\"../ui\").vNode} oldVnode\n * @param {object} context\n * @param {Array<import(\"../ui\").UiComponent>} mounts\n * @param {import(\"../ui\").UiComponent} previousComponent\n * @param {boolean} force\n */\nexport function diff(\n  parentDom,\n  newVnode,\n  oldVnode,\n  context,\n  mounts,\n  previousComponent,\n  force\n) {\n  if (typeof newVnode === \"boolean\") newVnode = null;\n  if (\n    oldVnode == null ||\n    newVnode == null ||\n    oldVnode.type !== newVnode.type\n    // oldVnode.key !== newVnode.key no stable keys implementation\n  ) {\n    if (oldVnode != null && oldVnode !== EMPTY_OBJ) {\n      unmountDomTree(oldVnode);\n    }\n    if (newVnode == null) {\n      return null;\n    }\n    oldVnode = EMPTY_OBJ;\n  }\n  const shouldGenerateNewTree = oldVnode === EMPTY_OBJ;\n\n  if (newVnode.__uAttr !== newVnode) {\n    console.warn(\"component not of expected type =>\", newVnode);\n    return null;\n  }\n\n  newVnode._children = flattenVNodeChildren(newVnode);\n  const newType = newVnode.type;\n  if (newType === Fragment || oldVnode.type === Fragment) {\n    return diffChildren(\n      newVnode,\n      shouldGenerateNewTree ? EMPTY_ARR : oldVnode._children || EMPTY_ARR,\n      parentDom,\n      context,\n      mounts,\n      previousComponent,\n      force\n    );\n  }\n  if (typeof newType === \"function\") {\n    let node;\n    const _obj = toSimpleVnode(\n      newVnode,\n      oldVnode,\n      parentDom,\n      mounts,\n      context,\n      force,\n      previousComponent\n    );\n    node = _obj.node;\n    const shouldUpdate = _obj.shouldUpdate;\n    if (newVnode._component != null) newVnode._component._vnode = newVnode;\n    if (node === EMPTY_OBJ) return null; //scu returned false\n    const dom = (newVnode._dom = diff(\n      parentDom,\n      node,\n      \"_prevVnode\" in oldVnode ? oldVnode._prevVnode : oldVnode,\n      context,\n      mounts,\n      newVnode._component,\n      force\n    ));\n    if (node == null) return;\n    node._dom = dom;\n    if (newVnode._component != null) newVnode._component.base = dom;\n    shouldUpdate &&\n      runLifeCycle(\n        newVnode._component,\n        \"componentDidUpdate\",\n        oldVnode.props,\n        (oldVnode._component || EMPTY_OBJ)._oldState\n      );\n    if (oldVnode._component != null) delete oldVnode._component._oldState;\n    if (node !== newVnode._prevVnode) newVnode._prevVnode = node;\n    if (dom != null && !Array.isArray(dom)) {\n      dom._vNode = newVnode;\n    }\n    return dom;\n  } else {\n    if (shouldGenerateNewTree) {\n      newVnode._dom = diffDom(newVnode, null, null, true);\n    } else {\n      newVnode._dom = diffDom(newVnode, oldVnode, oldVnode._dom, false);\n    }\n    if (previousComponent != null) {\n      previousComponent.base = newVnode._dom;\n    }\n  }\n  const dom = newVnode._dom;\n  dom._vNode = newVnode;\n  diffChildren(\n    newVnode,\n    shouldGenerateNewTree ? EMPTY_ARR : oldVnode._children || EMPTY_ARR,\n    dom,\n    context,\n    mounts,\n    newVnode._component,\n    force\n  );\n  return dom;\n}\n/**\n *\n * @param {import('../ui').vNode} vn\n */\nexport function flattenVNodeChildren(vn) {\n  return flattenArray(\n    (vn.props && vn.props.children) || EMPTY_ARR,\n    Infinity,\n    toVnode\n  );\n}\n","import { diff, flattenVNodeChildren } from \"./diff/index.js\";\nimport { Fragment, createElement } from \"./create-element.js\";\nimport { commitMounts } from \"./lifeCycleRunner.js\";\n\n/**\n *\n * @param {import(\"./ui\").vNode} vn\n * @param {import(\"./ui\").UiElement} parentDom\n */\nexport function render(vn, parentDom) {\n  const vnode = createElement(Fragment, null, vn);\n  if (parentDom.hasChildNodes()) {\n    /**\n     * Even though we had render called, we can still diff against the existing dom instead of\n     * removing the nodes and creating brand new dom\n     */\n    return hydrate(parentDom, vnode);\n  }\n  const mounts = [];\n  const oldVnode = null;\n  diff(parentDom, vnode, oldVnode, {}, mounts, null, false);\n  commitMounts(mounts);\n}\n\n/**\n *\n * @param {import(\"./ui\").UiNode} dom\n */\nfunction _getVnodeFromDom(dom) {\n  if (dom.nodeName === \"#comment\") {\n    /**should we call .remove on the node?  */ return;\n  }\n  if (dom instanceof Text) {\n    return dom.nodeValue;\n  }\n  const node = createElement(\n    dom.tagName,\n    null,\n    Array.from(dom.childNodes).map(_getVnodeFromDom)\n  );\n  node._children = flattenVNodeChildren(node);\n  node._dom = dom;\n  dom._vNode = node;\n  return node;\n}\n/**\n *\n * @param {import(\"./ui\").UiElement} dom\n * @param {import(\"./ui\").vNode} vnode\n */\nexport function hydrate(dom, vnode) {\n  const children = Array.from(dom.childNodes);\n  const vn = createElement(Fragment, null, children.map(_getVnodeFromDom));\n  vn._dom = children;\n  vn._children = flattenVNodeChildren(vn);\n  const mounts = [];\n  diff(dom, vnode, vn, {}, mounts, null, false);\n  commitMounts(mounts);\n}\n","import Component from \"../../component.js\";\nimport { createElement as h } from \"../../create-element.js\";\n\nclass AsyncComponent extends Component {\n  constructor(props, context) {\n    const { componentPromise, fallbackComponent, ..._props } = props;\n    super(_props, context);\n    this.state = {\n      ready: false,\n      componentPromise,\n      finalComponent: null,\n      fallbackComponent\n    };\n  }\n  static getDerivedStateFromProps(props, state) {\n    const s = state || {};\n    if (s.componentPromise === props.componentPromise) return s;\n    // we are still in a promise..let that load first or we will get stuck in an infinite loop\n    if (props.componentPromise != null) {\n      s.componentPromise = props.componentPromise;\n      s.ready = false;\n      s.finalComponent = null;\n    }\n    return s;\n  }\n  render(\n    { eager = true, loadComponent = false, ...props },\n    { ready, finalComponent }\n  ) {\n    if ((eager || loadComponent) && !ready) {\n      this.loadComponent();\n    }\n    if (ready) {\n      return h(finalComponent, props);\n    }\n    const { children, ..._props } = props;\n    return this.state.fallbackComponent != null\n      ? h(this.state.fallbackComponent, _props)\n      : _defaultLoader;\n  }\n\n  loadComponent() {\n    return this.state.componentPromise().then(ct => {\n      this.setState({ ready: true, finalComponent: ct });\n    });\n  }\n}\nconst _defaultLoader = h(\"div\", null, \"Loading..\");\nexport default AsyncComponent;\nexport { AsyncComponent as LazyComponent };\n","import Component from \"../../component.js\";\nimport { createElement as h, Fragment } from \"../../create-element.js\";\nimport { EMPTY_OBJ, assign } from \"../../util.js\";\n/**\n * @type {Array<(e:PopStateEvent|null)=>any>}\n */\nconst _routerSubscriptions = [];\nexport const RouterSubscription = {\n  /**\n   * @param {(e:PopStateEvent|null)=>any} fun\n   */\n  subscribe(fun) {\n    if (!_routerSubscriptions.includes(fun)) _routerSubscriptions.push(fun);\n  },\n  unsubscribe(fun) {\n    for (let i = 0; i < _routerSubscriptions.length; i++) {\n      if (_routerSubscriptions[i] === fun)\n        return _routerSubscriptions.splice(i, 1);\n    }\n  },\n  /**\n   * @param {string} e\n   */\n  emit(e, options) {\n    for (const subscription of _routerSubscriptions) {\n      subscription(e, options);\n    }\n  },\n  unsubscribeAll() {\n    _routerSubscriptions.length = 0;\n  }\n};\n\nexport function loadURL(url) {\n  window.history.pushState(EMPTY_OBJ, document.title, url);\n  RouterSubscription.emit(url, { type: \"load\", native: false });\n}\nexport function redirect(url) {\n  window.history.replaceState(EMPTY_OBJ, document.title, url);\n  RouterSubscription.emit(url, { type: \"redirect\", native: false });\n}\nclass Router extends Component {\n  static __emitter() {\n    RouterSubscription.emit(Router.getPath + Router.getQs, {\n      type: \"popstate\",\n      native: true\n    });\n  }\n  componentWillMount() {\n    RouterSubscription.subscribe(this._routeChangeHandler);\n    window.addEventListener(\"popstate\", Router.__emitter);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"popstate\", Router.__emitter);\n    if (this.props.destroySubscriptionOnUnmount) {\n      RouterSubscription.unsubscribeAll();\n    }\n  }\n  absolute(path) {\n    return new URL(\n      path || \"\",\n      `${location.protocol}//${location.host}`\n    ).toString();\n  }\n  getCurrentComponent() {\n    const currentPath = Router.getPath;\n    return this.getPathComponent(currentPath) || [];\n  }\n  _routeChangeHandler() {\n    const [component, match] = this.getCurrentComponent();\n    this.setState({ component, match });\n  }\n  _notFoundComponent() {\n    return h(\n      \"div\",\n      null,\n      `The Requested URL \"${this.absolute(Router.getPath)}\" was not found`\n    );\n  }\n  static get getPath() {\n    return location.pathname;\n  }\n  static get getQs() {\n    return location.search;\n  }\n  /**\n   * @returns {[any,RegExpExecArray]}\n   */\n  getPathComponent(route) {\n    for (const obj of this.state.routes) {\n      const { regex, component } = obj;\n      const match = regex.exec(route);\n      if (match) {\n        return [component, match];\n      }\n    }\n    return [];\n  }\n  initComponents(c) {\n    const _routes = [];\n    for (const child of c) {\n      if (child.props != null && child.props.path != null) {\n        _routes.push({\n          regex: child.props.path,\n          component: child\n        });\n      }\n    }\n    return _routes;\n  }\n  /**\n   *\n   * @param {{children:Array<import(\"../ui\").vNode>}} routerProps\n   * @param {object} context\n   */\n  constructor(routerProps, context) {\n    let { children, fallbackComponent, ...props } = routerProps;\n    super(props, context);\n    fallbackComponent = fallbackComponent || this._notFoundComponent.bind(this);\n    this.state = { routes: this.initComponents(children), fallbackComponent };\n    const [component, match] = this.getCurrentComponent();\n    this.state.component = component;\n    this.state.match = match;\n    this._routeChangeHandler = this._routeChangeHandler.bind(this);\n  }\n  componentDidMount() {\n    // this._routeChangeHandler();\n  }\n  render() {\n    /**\n     * @type {import(\"../../ui\").vNode}\n     */\n    let c;\n    const { children, ..._props } = this.props;\n    const sendProps = { match: this.state.match, ..._props };\n    if (this.state.component != null && this.state.match != null) {\n      c = this.state.component;\n      assign(c.props, sendProps);\n    } else {\n      c = h(this.state.fallbackComponent, sendProps);\n    }\n    if (!c.__uAttr) c = h(c, sendProps);\n\n    return h(Fragment, null, c);\n  }\n}\n\nexport function A(props) {\n  const { native, href, onClick, ...p } = props;\n  const setProps = p;\n  setProps.href = href;\n  if (!native && href != null) {\n    setProps.onClick = e => onLinkClick(e, props.href, onClick);\n  }\n  return h(\"a\", setProps);\n}\n/**\n *\n * @param {MouseEvent} e\n */\nfunction onLinkClick(e, href, func) {\n  if (e.altKey || e.ctrlKey || e.metaKey || e.shiftKey) {\n    return;\n  }\n  if (e.stopImmediatePropagation) {\n    e.stopImmediatePropagation();\n  }\n  if (e.stopPropagation) {\n    e.stopPropagation();\n  }\n  e.preventDefault();\n  loadURL(href);\n  if (func != null) func(e, href);\n}\nexport function absolutePath(route) {\n  return RegExp(`^${route}(/?)$`);\n}\n\nexport default Router;\n"],"names":["defer","Promise","prototype","then","bind","resolve","setTimeout","EMPTY_OBJ","EMPTY_ARR","_Obj","constructor","hasOwnProp","hasOwnProperty","assign","target","i","arguments","length","source","key","call","flattenArray","arr","depth","map","removeHoles","flattend","flat","array","el","Array","isArray","push","$","dom","value","removeAttribute","setAttribute","isListener","attr","appendChild","parentDom","child","vn","hasVn","insertBefore","_vNode","_nextDomNode","parentNode","_reorder","prevDom","previousSibling","nextDom","nextSibling","prevVnode","setDomNodeDescriptor","nextVnode","_prevDomNode","node","sibDom","desc","_prevVnode","createElement","type","props","children","Infinity","ref","events","substr","toLowerCase","getVNode","Fragment","vnode","_children","_dom","_component","__uAttr","toVnode","nodeType","String","runLifeCycle","c","method","args","__currentLifeCycle","fn","apply","e","componentDidCatch","unmountDomTree","cc","base","_vnode","d","pop","removeNode","onclick","_listeners","_currentProps","p","removeChild","commitMounts","mounts","_didMount","diffDom","newVnode","oldVnode","previousDom","_DisableDiff","document","createTextNode","diffAttributes","Text","newVal","nodeValue","isSafeAttr","currentDom","currVnode","newAttributes","prevAttributes","currEvents","prevEvents","newValue","oldValue","diffStyle","diffClass","newListeners","oldListeners","event","listener","addEventListener","eventListenerProxy","evt","removeEventListener","diffEventListeners","join","trim","st","style","oldValueIsString","cssText","styleProp","prop","this","diffChildren","newParentVnode","oldChildren","context","previousComponent","force","newChildren","newChildrenLength","oldChildrenLength","retArr","Math","max","newChild","oldChild","nextOldChild","getNextChild","nextOldDom","diff","oc","len","RENDER_QUEUE","Component","state","render","setState","updater","_nextState","_oldState","next","_dirty","window","requestAnimationFrame","process","forceUpdate","callback","Node","sort","x","y","_depth","getRenderer","_","shouldGenerateNewTree","console","warn","flattenVNodeChildren","newType","_obj","isNew","shouldComponentUpdate","shouldUpdate","getDerivedStateFromProps","toSimpleVnode","_getVnodeFromDom","nodeName","tagName","from","childNodes","hydrate","AsyncComponent","componentPromise","fallbackComponent","_props","_this","ready","finalComponent","s","eager","loadComponent","h","_defaultLoader","ct","_this2","_routerSubscriptions","RouterSubscription","subscribe","fun","includes","unsubscribe","splice","emit","options","unsubscribeAll","loadURL","url","history","pushState","title","native","Router","__emitter","getPath","getQs","routerProps","_notFoundComponent","routes","initComponents","getCurrentComponent","match","component","_routeChangeHandler","componentWillMount","componentWillUnmount","destroySubscriptionOnUnmount","absolute","path","URL","location","protocol","host","toString","getPathComponent","route","regex","exec","_routes","pathname","search","componentDidMount","sendProps","href","onClick","setProps","func","altKey","ctrlKey","metaKey","shiftKey","stopImmediatePropagation","stopPropagation","preventDefault","onLinkClick","RegExp","replaceState","hasChildNodes"],"mappings":"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"}