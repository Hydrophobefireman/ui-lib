const t="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,e="keys"in Object;let n;function o(t,e,n,o=!1){const l=[],r=(t,e)=>{for(const s of t)Array.isArray(s)&&e>0?r(s,e-1):o&&null==s||l.push(n?n(s):s)};return r(t,Math.floor(e)||1),l}n=e?(t,e)=>{for(const n of Object.keys(e))t[n]=e[n];return t}:(t,e)=>{for(const n in e)t[n]=e[n];return t};const l={},r=[],s={setAttribute:(t,e,n)=>e in t?t[e]=null==n?"":n:null==n?t.removeAttribute(e):t.setAttribute(e,n)},i=t=>"o"===t[0]&&"n"===t[1];function u(t,e){if(null==e)return;let n,o;if(e.parentNode!==t){let l;(o=null!=(n=e._vNode))&&(l=e._vNode._nextDomNode),null!=l?t.insertBefore(e,l):t.appendChild(e)}const l=e.previousSibling,r=e.nextSibling;if(l!=r){if(null!=l){const t=l._vNode;null!=t&&t._nextDomNode!==e&&p(t,e,"_nextDomNode")}if(null!=r){const t=r._vNode;null!=t&&t._nextDomNode!==e&&p(t,e,"_prevDomNode")}o&&(n._prevDomNode=l,n._nextDomNode=r)}}function p(t,e,n){t[n]=e;const o=t._prevVnode;null!=o&&p(o,e,n)}function c(t,e,...l){if(null==t||"boolean"==typeof t)return null;e=null==e?{}:n({},e),l.length&&(l=o(l,Infinity),e.children=l);const r=e.ref;r&&delete e.ref;const s=e.key;s&&delete e.key;const u={};for(const t in e)i(t)&&(u[t.substr(2).toLowerCase()]=e[t]);return d(t,e,u,s,r)}function a(){}function d(t,e,n,o,l){const r={type:t,props:e,events:n,key:o,ref:l,_children:null,_dom:null,_component:null,__uAttr:null,_nextDomNode:null,_prevDomNode:null,_prevVnode:null};return r.__uAttr=r}function m(t){if(null==t||"boolean"==typeof t)return null;if("string"==typeof t||"number"==typeof t)return d(null,String(t));if(Array.isArray(t))return c(a,null,t);if(null!=t._dom){const e=d(t.type,t.props,t.events,t.key,null);return e._dom=t._dom,e}return t}const f=(t,e,...n)=>{if(t.__currentLifeCycle=e,null!=t[e])try{t[e](...n)}catch(e){if(null==t.componentDidCatch)throw e;t.componentDidCatch(e)}};function _(t,e,...n){t&&(t=f(t,e,...n))}function h(t){if(t===l||null==t)return;t._prevVnode&&h(t._prevVnode);const e=t._dom,n=t._component;if(_(n,"componentWillUnmount",!0),null!=n&&(n.base=n._vnode=null),e){if(null!=t){null!=t._nextDomNode&&p(t._nextDomNode._vNode,null,"_prevDomNode"),null!=t._prevDomNode&&p(t._prevDomNode._vNode,null,"_nextDomNode");for(const e of t._children||r)h(e);t._prevVnode=t._component=t._dom=t._prevDomNode=t._nextDomNode=null}if(t.type===a){let e;for(;e=t._children.pop();)y(e)}else y(e);e.onclick=e._component=e._listeners=e._prevVnode=e._vNode=null}}function y(t){const e=t.parentNode;e&&e.removeChild(t)}function v(t){let e;for(;e=t.pop();)_(e,"componentDidMount"),e._didMount=!0}function b(t,e,n,o){let r;const s=t.type;if(o)"string"==typeof t.props?r=document.createTextNode(t.props):C(r=document.createElement(s),t,l);else{if(s!==e.type)return b(t,null,null,!0);if(r=n,n instanceof Text){const e=t.props;n.nodeValue!==e&&(n.nodeValue=e)}else C(r,t,e)}return null!=t._prevVnode&&(t._prevVnode._dom=r),r}const x=t=>"key"!==t&&"children"!==t;function C(t,e,n){if(t instanceof Text)return;const o=e.props,r=t.attributes,u=e.events,p=null!=n?n.events:l;for(let e=0;e<r.length;e++){const n=r[e].name;n in o||s.setAttribute(t,n,null)}for(let e in o){if(i(e)||!x(e))continue;let n=o[e];const u=e in t?t[e]:(r[e]||l).value;if("className"===(e="class"===e?"className":e)&&Array.isArray(n)&&(n=n.join(" ")),"style"!==e)u!==n&&s.setAttribute(t,e,n);else{const e=t.style;if("string"==typeof n)e.cssText=n;else{"string"==typeof u?e.cssText="":u&&(u.cssText="");for(const t in n){const o=n[t];u&&o===u[t]||(e[t]=o)}}}}!function(t,e,n){if(t!=e){null==n._listeners&&(n._listeners={},n.onclick=a),null==e&&(e=l),null==t&&(t=l);for(const o in t){const l=t[o];e[o]!==l&&null!=l&&(n.addEventListener(o,g),n._listeners[o]=l)}for(const o in e)null==t[o]&&(delete n._listeners[o],n.removeEventListener(o,g))}}(u,p,t)}function g(t){return this._listeners[t.type](t)}function N(t,e,n,o,l,r,s){const i=t._children.length,p=e.length,c=[];for(let d=0;d<i;d++){const i=t._children[d];let m=e[d];const f=e[d+1];if(i===m)continue;if(null==i){h(m);continue}if(null==m&&null!=f&&(i._nextDomNode=f.type!==a?f._dom:f._dom[0]),null===m||D(m,i))e[d]=void 0;else for(let t=0;t<p;t++){if(D(m=e[t],i)){e[t]=void 0;break}m=null}const _=w(n,i,m,o,l,r,s);if(Array.isArray(_))for(const t of _)u(n,t),c.push(t);else u(n,_),c.push(_)}for(const t of e)null!=t&&h(t);return c}function D(t,e){return t&&e.key===t.key&&e.type===t.type}const S=[];class k{constructor(t,e){this.props=t,this.context=e}render(t,e){}setState(e){const o="function"==typeof e?e=e(this._nextState,this.props):e;var r;null!=o&&(this._nextState=n({},this.state||l),this._oldState=n({},this._nextState),n(this._nextState,o),(r=this)._dirty=!0,1===S.push(r)&&(null!=window.requestAnimationFrame?window.requestAnimationFrame(P):t(P)))}forceUpdate(t){const e=this.parentDom,n=[];if(e){const o=this._vnode;this.base=w(e,o,o,this.context,n,this,!1!==t),this.base instanceof Node&&!this.base.parentNode&&u(e,this.base)}t&&t(),v(n)}}function P(){let t;for(S.sort((t,e)=>t._depth-e._depth);t=S.pop();)n(t.state,t._nextState||l),t._nextState=null,t._dirty=!1,t.forceUpdate(!1)}function A(t,e,n){return this.constructor(t,n)}function w(t,e,s,i,u,p,c){if("boolean"==typeof e&&(e=null),null!=s&&null!=e&&(e._nextDomNode=s._nextDomNode),null==s||null==e||s.type!==e.type||s.key!==e.key){if(null!=s&&s!==l&&h(s),null==e)return null;s=l}const d=s===l;if(e.__uAttr!==e)return console.warn("component not of expected type =>",e),null;e._children=o(e.props&&e.props.children||[],Infinity,m);const f=e.type;if(f===a||s.type==a){if(e.type!==a){const n=function(t,e){for(const n of e)if(n.type===t)return n}(f,s._children||r),o=(s._children||r).filter(t=>t!==n);for(const t of o)h(t);return w(t,e,n,i,u,p,c)}return N(e,d?r:s._children||r,t,i,u,p,c)}if("function"==typeof f){let o;return o=function(t,e,o,r,s,i,u){let p,c,a;const d=t.type;if(e._component){if((p=t._component=e._component).base=t._dom=e._dom,p.props=t.props,p.context=s,a=!1,!i)if(null!=p.shouldComponentUpdate&&!1!==p.shouldComponentUpdate(t.props,p.state));else if(null!=p.shouldComponentUpdate)return l}else a=!0,d.prototype&&d.prototype.render?(p=t._component=new d(t.props,s),r.push(p)):(p=new k(t.props,s),t._component=null,p.constructor=d,p.render=A);return p.parentDom=o,null==p.state&&(p.state={}),p._nextState=n({},p.state),null!=d.getDerivedStateFromProps&&(n(p._nextState,d.getDerivedStateFromProps(t.props,p._nextState)||l),n(p._oldState||(p._oldState={}),p._nextState)),a?_(p,"componentWillMount"):_(p,"componentWillUpdate",t.props,p._nextState,s),p.state=p._nextState,(c=p._prevVnode=m(p.render(t.props,p.state)))&&(c._dom=t._dom),p._depth=u?1+~~u._depth:0,c}(e,s,t,u,i,c,p),null!=e._component&&(e._component._vnode=e),o===l?null:null==o?s._dom:(o._dom=e._dom=w(t,o,s._prevVnode||s,i,u,e._component,c),null!=e._component&&(e._component.base=e._dom),_(e._component,"componentDidUpdate",s.props,(s._component||l)._oldState),null!=s._component&&delete s._component._oldState,e._prevVnode=o,null!=e._dom&&(e._dom._vNode=e),e._dom)}return e._dom=d?b(e,null,null,!0):b(e,s,s._dom,!1),null!=p&&(p.base=e._dom),e._dom._vNode=e,N(e,d?r:s._children||r,e._dom,i,u,e._component,c),e._dom}function V(t,e){const n=c(a,null,[t]),o=[],l=e._oldVnode;e._oldVnode=t,w(e,n,l,{},o,null==l?null:l._component,!1),v(o)}class U extends k{constructor(t,e){const{componentPromise:n,fallbackComponent:o,...l}=t;super(l,e),this.state={ready:!1,componentPromise:n,finalComponent:null,fallbackComponent:o}}static getDerivedStateFromProps(t,e){const n=e||{};return n.componentPromise===t.componentPromise?n:(null!=t.componentPromise&&(n.componentPromise=t.componentPromise,n.ready=!1,n.finalComponent=null),n)}render({eager:t=!0,loadComponent:e=!1,...n},{ready:o,finalComponent:l}){if(!t&&!e||o||this.loadComponent(),o)return c(l,n);const{...r}=n;return null!=this.state.fallbackComponent?c(this.state.fallbackComponent,r):L}loadComponent(){return this.state.componentPromise().then(t=>{this.setState({ready:!0,finalComponent:t})})}}const L=c("div",null,"Loading.."),T=[],F={subscribe(t){T.push(t)},unsubscribe(t){},emit(t,e){for(const n of T)n(t,e)},unsubscribeAll(){T.length=0}};function E(t){window.history.pushState(l,document.title,t),F.emit(t,{type:"load",native:!1})}function M(t){window.history.replaceState(l,document.title,t),F.emit(t,{type:"redirect",native:!1})}class W extends k{componentWillMount(){F.subscribe(this._routeChangeHandler),window.addEventListener("popstate",F.emit)}componentWillUnmount(){window.removeEventListener("popstate",F.emit),this.props.destroySubscriptionOnUnmount&&F.unsubscribeAll()}absolute(t){return new URL(t||"",`${location.protocol}//${location.host}`).toString()}getCurrentComponent(){return this.getPathComponent(W.getPath)||[]}_routeChangeHandler(){const[t,e]=this.getCurrentComponent();this.component=this.match=null,this.setState({component:t,match:e})}_notFoundComponent(){return c("div",null,`The Requested URL "${this.absolute(W.getPath)}" was not found`)}static get getPath(){return location.pathname}static get getQs(){return location.search}getPathComponent(t){for(const e of this.state.routes){const{regex:n,component:o}=e,l=n.exec(t);if(l)return[o,l]}return[]}initComponents(t){for(const e of t)null!=e.props&&null!=e.props.path&&this.state.routes.push({regex:e.props.path,component:e})}constructor(t,e){let{children:n,fallbackComponent:o,...l}=t;super(l,e),o=o||this._notFoundComponent.bind(this),this.state={routes:[],fallbackComponent:o},this.initComponents(n);const[r,s]=this.getCurrentComponent();this.component=r,this.match=s,this._routeChangeHandler=this._routeChangeHandler.bind(this)}render(){let t;return(t=null!=this.state.component&&null!=this.state.match?this.state.component:this.component?this.component:c(this.state.fallbackComponent,this.props)).__uAttr||(t=c(t,{match:this.state.match,...this.props})),c(a,null,t)}}function $(t){const{native:e,href:n,onClick:o,...l}=t,r=l;return r.href=n,e||null==n||(r.onClick=(e=>(function(t,e,n){t.altKey||t.ctrlKey||t.metaKey||t.shiftKey||(t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),E(e),null!=n&&n(t,e))})(e,t.href,o))),c("a",r)}function H(t){return RegExp(`^${t}(/?)$`)}export default k;export{V as render,c as createElement,a as Fragment,c as h,U as AsyncComponent,W as Router,E as loadURL,M as redirect,F as RouterSubscription,$ as A,H as absolutePath};
//# sourceMappingURL=ui-lib.mjs.map
