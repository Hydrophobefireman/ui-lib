const t="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,e="keys"in Object?(t,e)=>{for(const n of Object.keys(e))t[n]=e[n];return t}:(t,e)=>{for(const n in e)t[n]=e[n];return t};function n(t,e,n,o=!1){const r=[],l=(t,e)=>{for(const s of t)Array.isArray(s)&&e>0?l(s,e-1):o&&null==s||r.push(n?n(s):s)};return l(t,~~e||1),r}const o={},r=[],l={setAttribute:(t,e,n)=>e in t?t[e]=null==n?"":n:null==n?t.removeAttribute(e):t.setAttribute(e,n)},s=t=>"o"===t[0]&&"n"===t[1];function i(t,e){if(null==e)return;let n,o,r;(o=null!=(n=e._vNode))&&(r=e._vNode._nextDomNode),(e.parentNode!==t||n._reorder)&&(null!=r?t.insertBefore(e,r):n._reorder||t.appendChild(e));const l=e.previousSibling,s=e.nextSibling;if(l!=s){if(null!=l){const t=l._vNode;null!=t&&t._nextDomNode!==e&&u(t,e,"_nextDomNode")}if(null!=s){const t=s._vNode;null!=t&&t._nextDomNode!==e&&u(t,e,"_prevDomNode")}o&&(n._prevDomNode=l,n._nextDomNode=s)}}function u(t,e,n){null!=t&&(t[n]=e,u(t._prevVnode,e,n))}function p(t,o,...r){if(null==t||"boolean"==typeof t)return null;o=null==o?{}:e({},o),r.length&&(r=n(r,Infinity),o.children=r);const l=o.ref;l&&delete o.ref;const i=o.key;i&&delete o.key;const u={};for(const t in o)s(t)&&(u[t.substr(2).toLowerCase()]=o[t]);return a(t,o,u,i,l)}function c(){}function a(t,e,n,o,r){const l={type:t,props:e,events:n,key:o,_reorder:!1,ref:r,_children:null,_dom:null,_component:null,__uAttr:null,_nextDomNode:null,_prevDomNode:null,_prevVnode:null};return l.__uAttr=l}function d(t){if(null==t||"boolean"==typeof t)return null;if("string"==typeof t||"number"==typeof t)return a(null,String(t));if(Array.isArray(t))return p(c,null,t);if(null!=t._dom){const e=a(t.type,t.props,t.events,t.key,null);return e._dom=t._dom,e}return t}const m=(t,e,...n)=>{if(t.__currentLifeCycle=e,null!=t[e])try{t[e](...n)}catch(e){if(null==t.componentDidCatch)throw e;t.componentDidCatch(e)}};function _(t,e,...n){t&&m(t,e,...n)}function f(t){if(t===o||null==t)return;t._prevVnode&&f(t._prevVnode);const e=t._dom,n=t._component;if(_(n,"componentWillUnmount",!0),null!=n&&(n.base=n._vnode=null),e){if(null!=t){null!=t._nextDomNode&&u(t._nextDomNode._vNode,null,"_prevDomNode"),null!=t._prevDomNode&&u(t._prevDomNode._vNode,null,"_nextDomNode");for(const e of t._children||r)f(e);t._prevVnode=t._component=t._dom=t._prevDomNode=t._nextDomNode=null}if(Array.isArray(e)){let e;for(;e=t._children.pop();)h(e)}else h(e);e.onclick=e._component=e._listeners=e._prevVnode=e._vNode=null}}function h(t){const e=t.parentNode;e&&e.removeChild(t)}function y(t){let e;for(;e=t.pop();)_(e,"componentDidMount"),e._didMount=!0}function v(t,e,n,r){let l;const s=t.type;if(r)"string"==typeof t.props?l=document.createTextNode(t.props):b(l=document.createElement(s),t,o);else{if(s!==e.type)return v(t,null,null,!0);if(l=n,n instanceof Text){const e=t.props;n.nodeValue!==e&&(n.nodeValue=e)}else b(l,t,e)}return null!=t._prevVnode&&(t._prevVnode._dom=l),l}const x=t=>"key"!==t&&"children"!==t;function b(t,e,n){if(t instanceof Text)return;const r=e.props,i=t.attributes,u=e.events,p=null!=n?n.events:o;for(let e=0;e<i.length;e++){const n=i[e].name;n in r||l.setAttribute(t,n,null)}for(let e in r){if(s(e)||!x(e))continue;let n=r[e];const u=e in t?t[e]:(i[e]||o).value;if("className"===(e="class"===e?"className":e)&&Array.isArray(n)&&(n=n.join(" ")),"style"!==e)u!==n&&l.setAttribute(t,e,n);else{const e=t.style;if("string"==typeof n)e.cssText=n;else{"string"==typeof u?e.cssText="":u&&(u.cssText="");for(const t in n){const o=n[t];u&&o===u[t]||(e[t]=o)}}}}!function(t,e,n){if(t!=e){null==n._listeners&&(n._listeners={},n.onclick=c),null==e&&(e=o),null==t&&(t=o);for(const o in t){const r=t[o];e[o]!==r&&null!=r&&(n.addEventListener(o,g),n._listeners[o]=r)}for(const o in e)null==t[o]&&(delete n._listeners[o],n.removeEventListener(o,g))}}(u,p,t)}function g(t){return this._listeners[t.type](t)}function C(t,e,n,o,r,l,s){const u=t._children,p=u.length,c=e.length,a=[];for(let t=0;t<Math.max(p,c);t++){const p=u[t];let d,m=e[t];if(null==p){null!=m&&f(m);continue}let _=p._nextDomNode;if(null==m&&null!=(d=N(e,c,t))){const t=d._dom;_=Array.isArray(t)?t[0]:t,p._nextDomNode=_,p._reorder=!0}const h=w(n,p,m,o,r,l,s);p._nextDomNode=_,Array.isArray(h)||(i(n,h),a.push(h))}return a}function N(t,e,n){let o;for(;n<e&&!(o=t[n]);n++);return o}const D=[];class S{constructor(t,e){this.props=t,this.context=e}render(t,e){}setState(n){const r="function"==typeof n?n=n(this._nextState,this.props):n;var l;null!=r&&(this._nextState=e({},this.state||o),this._oldState=e({},this._nextState),e(this._nextState,r),(l=this)._dirty=!0,1===D.push(l)&&(null!=window.requestAnimationFrame?window.requestAnimationFrame(A):t(A)),e(this.state,this._nextState||o))}forceUpdate(t){const e=this.parentDom,n=[];if(e){const o=this._vnode;this.base=w(e,o,o,this.context,n,this,!1!==t),this.base instanceof Node&&!this.base.parentNode&&i(e,this.base)}t&&t(),y(n)}}function A(){let t;for(D.sort((t,e)=>t._depth-e._depth);t=D.pop();)t._nextState=null,t._dirty=!1,t.forceUpdate(!1)}function P(t,e,n){return this.constructor(t,n)}function w(t,l,s,i,u,p,a,m){if("boolean"==typeof l&&(l=null),null==s||null==l||s.type!==l.type){if(null!=s&&s!==o&&f(s),null==l)return null;s=o}null!=s&&null!=l&&null==l._nextDomNode&&(l._nextDomNode=s._nextDomNode);const h=s===o;if(l.__uAttr!==l)return console.warn("component not of expected type =>",l),null;l._children=n(l.props&&l.props.children||[],Infinity,d);const y=l.type;if(y===c||s.type===c)return C(l,h?r:s._children||r,t,i,u,p,a);if("function"==typeof y){let n;if(n=function(t,n,r,l,s,i,u){let p,c,a;const m=t.type;if(n._component){if((p=t._component=n._component).base=t._dom=n._dom,p.props=t.props,p.context=s,a=!1,!i)if(null!=p.shouldComponentUpdate&&!1!==p.shouldComponentUpdate(t.props,p.state));else if(null!=p.shouldComponentUpdate)return o}else a=!0,m.prototype&&m.prototype.render?(p=t._component=new m(t.props,s),l.push(p)):(p=new S(t.props,s),t._component=null,p.constructor=m,p.render=P);return p.parentDom=r,null==p.state&&(p.state={}),p._nextState=e({},p.state),null!=m.getDerivedStateFromProps&&(e(p._nextState,m.getDerivedStateFromProps(t.props,p._nextState)||o),e(p._oldState||(p._oldState={}),p._nextState)),a?_(p,"componentWillMount"):_(p,"componentWillUpdate",t.props,p._nextState,s),p.state=p._nextState,(c=p._prevVnode=d(p.render(t.props,p.state)))&&(c._dom=t._dom,c._reorder=t._reorder),p._depth=u?1+~~u._depth:0,c}(l,s,t,u,i,a,p),null!=l._component&&(l._component._vnode=l),n===o)return null;const r=l._dom=w(t,n,"_prevVnode"in s?s._prevVnode:s,i,u,l._component,a);if(null==n)return;return n._dom=r,null!=l._component&&(l._component.base=r),_(l._component,"componentDidUpdate",s.props,(s._component||o)._oldState),null!=s._component&&delete s._component._oldState,l._prevVnode=n,null==r||Array.isArray(r)||(r._vNode=l),r}l._dom=h?v(l,null,null,!0):v(l,s,s._dom,!1),null!=p&&(p.base=l._dom);const x=l._dom;return x._vNode=l,C(l,h?r:s._children||r,x,i,u,l._component,a),x}function k(t,e){const n=p(c,null,[t]),o=[],r=e._oldVnode;e._oldVnode=t,w(e,n,r,{},o,null==r?null:r._component,!1),y(o)}class V extends S{constructor(t,e){const{componentPromise:n,fallbackComponent:o,...r}=t;super(r,e),this.state={ready:!1,componentPromise:n,finalComponent:null,fallbackComponent:o}}static getDerivedStateFromProps(t,e){const n=e||{};return n.componentPromise===t.componentPromise?n:(null!=t.componentPromise&&(n.componentPromise=t.componentPromise,n.ready=!1,n.finalComponent=null),n)}render({eager:t=!0,loadComponent:e=!1,...n},{ready:o,finalComponent:r}){if(!t&&!e||o||this.loadComponent(),o)return p(r,n);const{...l}=n;return null!=this.state.fallbackComponent?p(this.state.fallbackComponent,l):U}loadComponent(){return this.state.componentPromise().then(t=>{this.setState({ready:!0,finalComponent:t})})}}const U=p("div",null,"Loading.."),L=[],T={subscribe(t){L.includes(t)||L.push(t)},unsubscribe(t){for(let e=0;e<L.length;e++)if(L[e]===t)return L.splice(e,1)},emit(t,e){for(const n of L)n(t,e)},unsubscribeAll(){L.length=0}};function F(t){window.history.pushState(o,document.title,t),T.emit(t,{type:"load",native:!1})}function E(t){window.history.replaceState(o,document.title,t),T.emit(t,{type:"redirect",native:!1})}class M extends S{componentWillMount(){T.subscribe(this._routeChangeHandler),window.addEventListener("popstate",T.emit)}componentWillUnmount(){window.removeEventListener("popstate",T.emit),this.props.destroySubscriptionOnUnmount&&T.unsubscribeAll()}absolute(t){return new URL(t||"",`${location.protocol}//${location.host}`).toString()}getCurrentComponent(){return this.getPathComponent(M.getPath)||[]}_routeChangeHandler(){const[t,e]=this.getCurrentComponent();this.component=this.match=null,this.setState({component:t,match:e})}_notFoundComponent(){return p("div",null,`The Requested URL "${this.absolute(M.getPath)}" was not found`)}static get getPath(){return location.pathname}static get getQs(){return location.search}getPathComponent(t){for(const e of this.state.routes){const{regex:n,component:o}=e,r=n.exec(t);if(r)return[o,r]}return[]}initComponents(t){for(const e of t)null!=e.props&&null!=e.props.path&&this.state.routes.push({regex:e.props.path,component:e})}constructor(t,e){let{children:n,fallbackComponent:o,...r}=t;super(r,e),o=o||this._notFoundComponent.bind(this),this.state={routes:[],fallbackComponent:o},this.initComponents(n);const[l,s]=this.getCurrentComponent();this.component=l,this.match=s,this._routeChangeHandler=this._routeChangeHandler.bind(this)}render(){let t;return(t=null!=this.state.component&&null!=this.state.match?this.state.component:this.component?this.component:p(this.state.fallbackComponent,this.props)).__uAttr||(t=p(t,{match:this.state.match,...this.props})),t}}function W(t){const{native:e,href:n,onClick:o,...r}=t,l=r;return l.href=n,e||null==n||(l.onClick=(e=>(function(t,e,n){t.altKey||t.ctrlKey||t.metaKey||t.shiftKey||(t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),F(e),null!=n&&n(t,e))})(e,t.href,o))),p("a",l)}function $(t){return RegExp(`^${t}(/?)$`)}export default S;export{k as render,S as Component,p as createElement,c as Fragment,p as h,V as AsyncComponent,M as Router,F as loadURL,E as redirect,T as RouterSubscription,W as A,$ as absolutePath};
//# sourceMappingURL=ui-lib.mjs.map
