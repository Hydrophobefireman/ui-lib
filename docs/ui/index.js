var e="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,t={},n=[],o=t.constructor,r=t.hasOwnProperty,l="assign"in o?o.assign:function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)r.call(n,o)&&(e[o]=n[o])}return e};function a(e,t,n,o){void 0===o&&(o=!1);var r=[],l=(e,t)=>{for(var a of e)Array.isArray(a)&&t>0?l(a,t-1):o&&null==a||r.push(n?n(a):a)};return l(e,~~t||1),r}var i=(e,t,n)=>t in e?e[t]=null==n?"":n:null==n?e.removeAttribute(t):e.setAttribute(t,n),s=e=>"o"===e[0]&&"n"===e[1];function u(e,t){if(null!=t){var n,o,r;(o=null!=(n=t._vNode))&&(r=t._vNode._nextDomNode),(t.parentNode!==e||n._reorder)&&(null!=r?e.insertBefore(t,r):n._reorder||e.appendChild(t));var l=t.previousSibling,a=t.nextSibling;if(l!=a){if(null!=l){var i=l._vNode;null!=i&&i._nextDomNode!==t&&p(i,t,"_nextDomNode")}if(null!=a){var s=a._vNode;null!=s&&s._nextDomNode!==t&&p(s,t,"_prevDomNode")}o&&(n._prevDomNode=l,n._nextDomNode=a)}}}function p(e,t,n){null!=e&&(e[n]=t,p(e._prevVnode,t,n))}function d(e,t){for(var n=arguments.length,o=new Array(n>2?n-2:0),r=2;r<n;r++)o[r-2]=arguments[r];if(null==e||"boolean"==typeof e)return null;t=null==t?{}:l({},t),o.length&&(o=a(o,Infinity),t.children=o);var i=t.ref;i&&delete t.ref;var u=t.key;u&&delete t.key;var p={};for(var d in t)s(d)&&(p[d.substr(2).toLowerCase()]=t[d]);return m(e,t,p,u,i)}function c(){}function m(e,t,n,o,r){var l={type:"string"==typeof e?e.toLowerCase():e,props:t,events:n,key:o,_reorder:!1,ref:r,_children:null,_dom:null,_component:null,__uAttr:null,_nextDomNode:null,_prevDomNode:null,_prevVnode:null};return l.__uAttr=l}function f(e){if(null==e||"boolean"==typeof e)return null;if("string"==typeof e||"number"==typeof e)return m(null,String(e));if(Array.isArray(e))return d(c,null,e);if(null!=e._dom){var t=m(e.type,e.props,e.events,e.key,null);return t._dom=e._dom,t}return e}function _(e,t){for(var n=arguments.length,o=new Array(n>2?n-2:0),r=2;r<n;r++)o[r-2]=arguments[r];if(e&&(e.__currentLifeCycle=t,null!=e[t])){var l=function(){e[t].apply(e,o)};if("undefined"!=typeof Promise)return Promise.resolve(l()).catch(t=>e.componentDidCatch&&e.componentDidCatch(t));try{l()}catch(t){e.componentDidCatch&&e.componentDidCatch(t)}}}function v(e){if(e!==t&&null!=e){e._prevVnode&&v(e._prevVnode);var o=e._dom,r=e._component;if(_(r,"componentWillUnmount",!0),null!=r&&(r.base=r._vnode=null),o){for(var l of(null!=e._nextDomNode&&p(e._nextDomNode._vNode,null,"_prevDomNode"),null!=e._prevDomNode&&p(e._prevDomNode._vNode,null,"_nextDomNode"),e._children||n))v(l);if(e._prevVnode=e._component=e._dom=e._prevDomNode=e._nextDomNode=null,Array.isArray(o))for(var a;a=n.pop.call(o||n);)h(a);else h(o);o.onclick=o._component=o._listeners=o._prevVnode=o._vNode=o._currentProps=null}}}function h(e){var t=e.parentNode;t&&t.removeChild(e)}function y(e){for(var t;t=e.pop();)_(t,"componentDidMount"),t._didMount=!0}function g(e,n,o,r){var l,a=e.type;if(r)"string"==typeof e.props?l=document.createTextNode(e.props):b(l=document.createElement(a),e,t);else{if(a!==n.type)return g(e,null,null,!0);if(l=o,o instanceof Text){var i=e.props;o.nodeValue!==i&&(o.nodeValue=i)}else b(l,e,n)}return null!=e._prevVnode&&(e._prevVnode._dom=l),l}var C=e=>"key"!==e&&"children"!==e;function b(e,n,o){if(!(e instanceof Text)){var r=n.props,l=e._currentProps||t;e._currentProps=r;var a=n.events,u=null!=o?o.events:t;for(var p in l)p in r||i(e,p,null);for(var d in r)if(!s(d)&&C(d)){var m=r[d],f=l[d];m!==f&&("className"!==(d="class"===d?"className":d)?"style"!==d?i(e,d,m):N(e,m,f):x(e,m,f))}!function(e,n,o){if(e!=n){for(var r in null==o._listeners&&(o.onclick=c,o._listeners={}),null==n&&(n=t),null==e&&(e=t),e){var l=e[r];n[r]!==l&&null!=l&&(o.addEventListener(r,D),o._listeners[r]=l)}for(var a in n)null==e[a]&&(delete o._listeners[a],o.removeEventListener(a,D))}}(a,u,e)}}function x(e,t,n){var o=Array.isArray;o(t)&&(t=t.join(" ").trim()),o(n)&&(n=n.join(" ").trim()),t!==n&&i(e,"className",t)}function N(e,t,n){n=n||"";var o=e.style;if("string"!=typeof t){var r="string"==typeof n;if(r)o.cssText="";else for(var l in n)l in t||(o[l]="");for(var a in t){var i=t[a];(r||i!==n[a])&&(o[a]=i)}}else o.cssText=t}function D(e){return this._listeners[e.type].call(this,e)}function P(e,n,o,r,l,a,i){for(var s=e._children,p=s.length,d=n.length,c=[],m=0;m<Math.max(p,d);m++){var f=s[m],_=n[m]||t,h=void 0;if(null!=f){var y=f._nextDomNode||_._nextDomNode;if(_===t&&null!=(h=S(n,d,m))){var g=h._dom;y=Array.isArray(g)?g[0]:g,f._reorder=!0}f._nextDomNode=y;var C=U(o,f,_,r,l,a,i);Array.isArray(C)||(u(o,C),c.push(C))}else null!=_&&v(_)}return c}function S(e,t,n){for(var o;n<t&&!(o=e[n]);n++);return o}var A=[];class w{constructor(e,t){this.props=e,this.context=t,this.state={}}render(e,t){}setState(n){this._nextState=l({},this.state||t),this._oldState=l({},this._nextState);var o,r="function"==typeof n?n=n(this._nextState,this.props):n;null!=r&&(l(this._nextState,r),l(this.state,this._nextState),(o=this)._dirty=!0,1===A.push(o)&&(null!=window.requestAnimationFrame?window.requestAnimationFrame(k):e(k)))}forceUpdate(e){var t=this.parentDom,n=[];if(t){var o=this._vnode;this.base=U(t,o,o,this.context,n,this,!1!==e),this.base instanceof Node&&!this.base.parentNode&&u(t,this.base)}e&&e(),y(n)}}function k(){var e;for(A.sort((e,t)=>e._depth-t._depth);e=A.pop();)e._dirty&&(e._nextState=null,e._dirty=!1,e.forceUpdate(!1))}function V(e,t,n){return this.constructor(e,n)}function U(e,o,r,a,i,s,u){if("boolean"==typeof o&&(o=null),null==r||null==o||r.type!==o.type){if(null!=r&&r!==t&&v(r),null==o)return null;r=t}var p=r===t;if(o.__uAttr!==o)return console.warn("component not of expected type =>",o),null;o._children=L(o);var d=o.type;if(d===c||r.type===c)return P(o,p?n:r._children||n,e,a,i,s,u);if("function"==typeof d){var m,h=function(e,n,o,r,a,i,s){var u,p,d,c=e.type;if(n._component){if((u=e._component=n._component).base=e._dom=n._dom,u.props=e.props,u.context=a,d=!1,!i)if(null!=u.shouldComponentUpdate&&!1!==u.shouldComponentUpdate(e.props,u.state));else if(null!=u.shouldComponentUpdate)return{node:t,shouldUpdate:!1}}else d=!0,c.prototype&&c.prototype.render?(u=e._component=new c(e.props,a),r.push(u)):(u=new w(e.props,a),e._component=null,u.constructor=c,u.render=V);return u.parentDom=o,null==u.state&&(u.state={}),u._nextState=l({},u.state),null!=c.getDerivedStateFromProps&&(l(u._nextState,c.getDerivedStateFromProps(e.props,u._nextState)||t),l(u._oldState||(u._oldState={}),u._nextState)),d?_(u,"componentWillMount"):_(u,"componentWillUpdate",e.props,u._nextState,a),u.state=u._nextState,(p=u._prevVnode=f(u.render(e.props,u.state)))&&(p._dom=e._dom,p._reorder=e._reorder),u._depth=s?1+~~s._depth:0,{node:p,shouldUpdate:!d}}(o,r,e,i,a,u,s);m=h.node;var y=h.shouldUpdate;if(null!=o._component&&(o._component._vnode=o),m===t)return null;var C=o._dom=U(e,m,"_prevVnode"in r?r._prevVnode:r,a,i,o._component,u);if(null==m)return;return m._dom=C,null!=o._component&&(o._component.base=C),y&&_(o._component,"componentDidUpdate",r.props,(r._component||t)._oldState),null!=r._component&&delete r._component._oldState,m!==o._prevVnode&&(o._prevVnode=m),null==C||Array.isArray(C)||(C._vNode=o),C}o._dom=p?g(o,null,null,!0):g(o,r,r._dom,!1),null!=s&&(s.base=o._dom);var b=o._dom;return b._vNode=o,P(o,p?n:r._children||n,b,a,i,o._component,u),b}function L(e){return a(e.props&&e.props.children||n,Infinity,f)}function T(e,t){var n=d(c,null,e);if(t.hasChildNodes())return O(t,n);var o=[];U(t,n,null,{},o,null,!1),y(o)}function F(e){if("#comment"!==e.nodeName){if(e instanceof Text)return e.nodeValue;var t=d(e.tagName,function(e){for(var t={},n=e.length,o=0;o<n;o++){var r=e[o];t[r.name]=r.value}return t}(e.attributes),Array.from(e.childNodes).map(F));return t._children=L(t),t._dom=e,e._vNode=t,t}}function O(e,t){var n=Array.from(e.childNodes),o=d(c,null,n.map(F));o._dom=n,o._children=L(o);var r=[];U(e,t,o,{},r,null,!1),y(r)}function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function M(e,t){if(null==e)return{};var n,o,r={},l=Object.keys(e);for(o=0;o<l.length;o++)t.indexOf(n=l[o])>=0||(r[n]=e[n]);return r}class j extends w{constructor(e,t){var{componentPromise:n,fallbackComponent:o}=e;super(M(e,["componentPromise","fallbackComponent"]),t),this.state={ready:!1,componentPromise:n,finalComponent:null,fallbackComponent:o}}static getDerivedStateFromProps(e,t){var n=t||{};return n.componentPromise===e.componentPromise||null!=e.componentPromise&&(n.componentPromise=e.componentPromise,n.ready=!1,n.finalComponent=null),n}render(e,t){var{eager:n=!0,loadComponent:o=!1}=e,r=M(e,["eager","loadComponent"]),{ready:l,finalComponent:a}=t;if(!n&&!o||l||this.loadComponent(),l)return d(a,r);var i=M(r,["children"]);return null!=this.state.fallbackComponent?d(this.state.fallbackComponent,i):W}loadComponent(){return this.state.componentPromise().then(e=>{this.setState({ready:!0,finalComponent:e})})}}var W=d("div",null,"Loading.."),H=[],I={subscribe(e){H.includes(e)||H.push(e)},unsubscribe(e){for(var t=0;t<H.length;t++)if(H[t]===e)return H.splice(t,1)},emit(e,t){for(var n of H)n(e,t)},unsubscribeAll(){H.length=0}};function K(e){window.history.pushState(t,document.title,e),I.emit(e,{type:"load",native:!1})}function R(e){window.history.replaceState(t,document.title,e),I.emit(e,{type:"redirect",native:!1})}class q extends w{static __emitter(){I.emit(q.getPath+q.getQs,{type:"popstate",native:!0})}componentWillMount(){I.subscribe(this._routeChangeHandler),window.addEventListener("popstate",q.__emitter)}componentWillUnmount(){window.removeEventListener("popstate",q.__emitter),this.props.destroySubscriptionOnUnmount&&I.unsubscribeAll()}absolute(e){return new URL(e||"",location.protocol+"//"+location.host).toString()}getCurrentComponent(){return this.getPathComponent(q.getPath)||[]}_routeChangeHandler(){var[e,t]=this.getCurrentComponent();this.setState({component:e,match:t})}_notFoundComponent(){return d("div",null,'The Requested URL "'+this.absolute(q.getPath)+'" was not found')}static get getPath(){return location.pathname}static get getQs(){return location.search}getPathComponent(e){for(var t of this.state.routes){var{regex:n,component:o}=t,r=n.exec(e);if(r)return[o,r]}return[]}initComponents(e){var t=[];for(var n of e)null!=n.props&&null!=n.props.path&&t.push({regex:n.props.path,component:n});return t}constructor(e,t){var{children:n,fallbackComponent:o}=e;super(M(e,["children","fallbackComponent"]),t),o=o||this._notFoundComponent.bind(this),this.state={routes:this.initComponents(n),fallbackComponent:o};var[r,l]=this.getCurrentComponent();this.state.component=r,this.state.match=l,this._routeChangeHandler=this._routeChangeHandler.bind(this)}componentDidMount(){}render(){var e,t=M(this.props,["children"]),n=E({match:this.state.match},t);return null!=this.state.component&&null!=this.state.match?l((e=this.state.component).props,n):e=d(this.state.fallbackComponent,n),e.__uAttr||(e=d(e,n)),d(c,null,e)}}function Q(e){var{native:t,href:n,onClick:o}=e,r=M(e,["native","href","onClick"]);return r.href=n,t||null==n||(r.onClick=t=>function(e,t,n){e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||(e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.stopPropagation&&e.stopPropagation(),e.preventDefault(),K(t),null!=n&&n(e,t))}(t,e.href,o)),d("a",r)}function B(e){return RegExp("^"+e+"(/?)$")}export default w;export{Q as A,j as AsyncComponent,w as Component,c as Fragment,q as Router,I as RouterSubscription,B as absolutePath,d as createElement,d as h,O as hydrate,K as loadURL,R as redirect,T as render};
//# sourceMappingURL=ui-lib.modern.js.map
